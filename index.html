
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hustle</title>
    <!-- Import Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Space+Grotesk:wght@500;600&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Import Firebase (compatibility version) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        /* General Styles */
        body {
            font-family: 'Manrope', sans-serif;
            background: #121212;
            color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            overflow: hidden;
            position: relative;
        }

        .container {
            max-width: 500px;
            width: 90%;
            padding: 40px 30px;
            background: #1e1e1e;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            z-index: 10;
            margin: 20px 0;
        }

        h1 {
            font-size: clamp(2.5em, 8vw, 3.5em);
            margin: 0 0 20px 0;
            font-weight: 700;
            font-family: 'Space Grotesk', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .hustle span {
            display: inline-block;
            transition: transform 0.3s ease, color 0.3s ease;
            animation: wave 2s infinite ease-in-out;
        }

        .hustle span:hover {
            animation: hoverWave 0.5s ease-in-out;
        }

        /* Wave Animation */
        @keyframes wave {
            0%, 100% {
                transform: translateY(0);
            }
            25% {
                transform: translateY(-10px);
            }
            50% {
                transform: translateY(0);
            }
            75% {
                transform: translateY(10px);
            }
        }

        /* Hover Animation */
        @keyframes hoverWave {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-15px);
            }
        }

        /* Individual Letter Colors */
        .hustle span:nth-child(1) { color: #ff6f61; animation-delay: 0s; }
        .hustle span:nth-child(2) { color: #ffcc00; animation-delay: 0.2s; }
        .hustle span:nth-child(3) { color: #00bcd4; animation-delay: 0.4s; }
        .hustle span:nth-child(4) { color: #ff4081; animation-delay: 0.6s; }
        .hustle span:nth-child(5) { color: #4caf50; animation-delay: 0.8s; }
        .hustle span:nth-child(6) { color: #e91e63; animation-delay: 1s; }

        .name span:nth-child(1) { color:rgb(174, 185, 25); animation-delay: 0.1s; }
        .name span:nth-child(2) { color: #80DEEA; animation-delay: 0.3s; }
        .name span:nth-child(3) { color: #CE93D8; animation-delay: 0.5s; }
        .name span:nth-child(4) { color:rgb(170, 69, 146); animation-delay: 0.7s; }
        .name span:nth-child(5) { color: #FFF59D; animation-delay: 0.9s; }
        .name span:nth-child(6) { color:rgb(64, 173, 39); animation-delay: 1.1s; }
        
        .tagline {
            font-size: clamp(1em, 4vw, 1.2em);
            font-weight: 500;
            margin-bottom: 10px;
            color: #b0b0b0;
        }

        .start-date {
            font-size: clamp(1em, 3.5vw, 1.1em);
            font-weight: 400;
            margin-top: 10px;
            margin-bottom: 25px;
            color: #b0b0b0;
        }

        .profile {
            border-radius: 12px;
            padding: 25px;
            background: #2a2a2a;
            border: 1px solid #444;
            text-align: center;
            margin-bottom: 20px;
        }

        .profile .name {
            font-size: clamp(2em, 6vw, 2.2em);
            font-weight: 600;
            margin-bottom: 15px;
        }

        .profile .stats {
            font-size: clamp(1em, 4vw, 1.2em);
            margin-bottom: 10px;
            color: #b0b0b0;
        }

        .profile .stats span {
            font-size: clamp(1em, 5vw, 1.1em);
            font-weight: 700;
            color: #00ffcc;
        }

        .profile button {
            padding: 12px 24px;
            background: #444;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.2s ease;
            width: 100%;
            max-width: 200px;
            margin-top: 15px;
        }

        .profile button:hover {
            background: #666;
            transform: translateY(-2px);
        }

        .profile button.disabled {
            background: #333;
            cursor: not-allowed;
            transform: none;
        }

        .milestones {
            margin-top: 20px;
            font-size: clamp(0.9em, 3.5vw, 1em);
            color: #b0b0b0;
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .milestone {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: transform 0.3s ease, background 0.3s ease;
        }

        .milestone.unlocked {
            background: #00ffcc;
            color: #0f0c29;
        }

        .milestone:hover {
            transform: scale(1.05);
        }

        .milestone span {
            font-size: 1.2em;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #333;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 0.9em;
            z-index: 1000;
            display: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            text-align: center;
            transition: all 0.3s ease;
        }

        .toast.error {
            background: #ff4444;
        }

        /* Star Effect */
        .stars {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }

        .stars span {
            position: absolute;
            border-radius: 50%;
            background: white;
            animation: twinkle 1.5s infinite ease-in-out;
        }

        @keyframes twinkle {
            0% {
                opacity: 0;
                transform: scale(0.5);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(0.5);
            }
        }
        
        /* Stats container */
        .stats-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 18px 15px;
            border-radius: 8px;
            width: 100%;
            max-width: 160px;
        }

        /* New Animation Styles */
        .updated {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .checkmark {
            margin-left: 5px;
            color: #00ffcc;
        }
        
        .pulse {
            animation: buttonPulse 2s infinite;
        }
        
        @keyframes buttonPulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 204, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 204, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 204, 0); }
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #00ffcc;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 400px) {
            .container {
                padding: 30px 20px;
            }
            .profile {
                padding: 20px 15px;
            }
            .milestone {
                padding: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- Star effect container -->
    <div class="stars" id="stars"></div>

    <div class="container">
        <h1 class="hustle">
            <span>H</span>
            <span>U</span>
            <span>S</span>
            <span>T</span>
            <span>L</span>
            <span>E</span>
        </h1>
        <div class="tagline">
            GRIND GROW RISE
        </div>
        <div class="profile">
            <span class="name">
                <span>A</span>
                <span>T</span>
                <span>H</span>
                <span>A</span>
                <span>R</span>
                <span>V</span>
            </span>
            <div class="start-date">April 13, 2025</div>
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stats">
                        <span>Days: <span id="growth-days">0</span></span>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stats">
                        <span>Months: <span id="growth-months">0</span></span>
                    </div>
                </div>
            </div>
            <button id="level-up-btn">Level Up</button>
        </div>
        <div class="milestones" id="milestones"></div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Cache DOM elements
        const growthDaysEl = document.getElementById("growth-days");
        const growthMonthsEl = document.getElementById("growth-months");
        const milestonesContainer = document.getElementById('milestones');
        const levelUpBtn = document.getElementById("level-up-btn");
        const toastEl = document.getElementById('toast');
        const starsContainer = document.getElementById('stars');

        // Firebase configuration
        const firebaseConfig = {
             apiKey: "AIzaSyD1ikgcPsax9KsB-oN0xRgg1JYZDsn0Kao",
             authDomain: "grindhub-a9aaf.firebaseapp.com",
             projectId: "grindhub-a9aaf",
             storageBucket: "grindhub-a9aaf.appspot.com",
             messagingSenderId: "148461103277",
             appId: "1:148461103277:web:301a5d4508c1d71d91fe24",
             measurementId: "G-L6WJJB4N53"
         }; 

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // Constants
        const START_DATE = "2025-04-13";
        const MILESTONES = [
            { days: 21, symbol: "🌱", name: "21 Days" },
            { days: 90, symbol: "🚀", name: "90 Days" },
            { days: 180, symbol: "🌟", name: "180 Days" },
            { days: 365, symbol: "🏆", name: "365 Days" }
        ];

        // Helper functions with timezone handling
        function getToday() {
            const now = new Date();
            const localDate = new Date(now.getTime() - now.getTimezoneOffset() * 60000);
            return localDate.toISOString().split('T')[0];
        }

        function formatDate(date) {
            const d = new Date(date);
            return d.toISOString().split('T')[0];
        }

        function calculateDaysSince(startDate, endDate = new Date()) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = Math.abs(end - start);
            return Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
        }

        function calculateMonthsSince(startDate, endDate = new Date()) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            let months = (end.getFullYear() - start.getFullYear()) * 12;
            months += end.getMonth() - start.getMonth();
            
            if (end.getDate() < start.getDate()) {
                months--;
            }
            
            return Math.max(0, months);
        }

        // UI Functions
        function showToast(message, isError = false) {
            toastEl.textContent = message;
            toastEl.className = isError ? 'toast error' : 'toast';
            toastEl.style.display = 'block';
            setTimeout(() => {
                toastEl.style.display = 'none';
            }, isError ? 5000 : 3000);
        }

        function updateUI(data) {
            try {
                // Show loading state while processing
                growthDaysEl.textContent = '--';
                growthMonthsEl.textContent = '--';
                levelUpBtn.disabled = true;
                levelUpBtn.classList.add('disabled');
                
                if (!data) {
                    showToast("No data available", true);
                    return;
                }
                
                const today = getToday();
                const startDate = data.startDate || START_DATE;
                
                // Validate start date
                if (isNaN(new Date(startDate).getTime())) {
                    throw new Error("Invalid start date");
                }
                
                const currentDays = calculateDaysSince(startDate);
                const currentMonths = calculateMonthsSince(startDate);
                
                // Validate calculations
                if (currentDays <= 0 || currentMonths < 0) {
                    throw new Error("Invalid day/month calculation");
                }
                
                // Update UI elements
                growthDaysEl.textContent = currentDays;
                growthMonthsEl.textContent = currentMonths;
                updateMilestones(currentDays);
                
                // Update button state with animation
                if (data.lastUpdatedDate === today) {
                    levelUpBtn.classList.add('disabled', 'pulse');
                    levelUpBtn.disabled = true;
                    levelUpBtn.innerHTML = 'Completed Today <span class="checkmark">✓</span>';
                } else {
                    levelUpBtn.classList.remove('disabled', 'pulse');
                    levelUpBtn.disabled = false;
                    levelUpBtn.textContent = 'Level Up';
                }
                
                // Add visual feedback for updates
                if (data.lastUpdatedDate === today) {
                    growthDaysEl.classList.add('updated');
                    setTimeout(() => growthDaysEl.classList.remove('updated'), 1000);
                }
                
            } catch (error) {
                console.error("UI update error:", error);
                showToast("Error displaying data", true);
                
                // Fallback display
                growthDaysEl.textContent = '?';
                growthMonthsEl.textContent = '?';
                levelUpBtn.disabled = true;
            }
        }

        function updateMilestones(days) {
            milestonesContainer.innerHTML = MILESTONES.map(m => `
                <div class="milestone ${days >= m.days ? 'unlocked' : ''}">
                    <span>${m.symbol}</span>
                    <span>${m.name}</span>
                </div>
            `).join("");
        }

        // Database Functions
        async function initializeUserData() {
            const docRef = db.collection("atharvGrowth").doc("atharvData");
            const doc = await docRef.get();
            
            if (!doc.exists) {
                await docRef.set({
                    startDate: START_DATE,
                    lastUpdatedDate: "",
                    initialized: true
                });
            }
            
            return docRef;
        }

        async function updateStreak(retries = 3) {
            try {
                const docRef = await initializeUserData();
                const today = getToday();
                const doc = await docRef.get();
                
                if (!doc.exists) {
                    throw new Error("Document does not exist");
                }
                
                const data = doc.data();
                
                if (data.lastUpdatedDate === today) return false;
                
                const currentDays = calculateDaysSince(data.startDate);
                const currentMonths = calculateMonthsSince(data.startDate);
                
                await docRef.update({
                    lastUpdatedDate: today,
                    days: currentDays,
                    months: currentMonths
                });
                
                return true;
            } catch (error) {
                if (retries > 0) {
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    return updateStreak(retries - 1);
                }
                console.error("Update streak error:", error);
                showToast("Error updating streak. Please refresh.", true);
                return false;
            }
        }

        // Event Handlers
        async function handleLevelUp() {
            try {
                // Show loading state
                levelUpBtn.disabled = true;
                levelUpBtn.innerHTML = 'Processing <span class="loading-spinner"></span>';
                
                const updated = await updateStreak();
                if (updated) {
                    showToast("Leveled up successfully!");
                    const docRef = db.collection("atharvGrowth").doc("atharvData");
                    const doc = await docRef.get();
                    updateUI(doc.data());
                } else {
                    showToast("You've already leveled up today!");
                    updateUI(doc.data());
                }
            } catch (error) {
                console.error("Level up error:", error);
                showToast("Failed to level up. Please try again.", true);
            } finally {
                const docRef = db.collection("atharvGrowth").doc("atharvData");
                const doc = await docRef.get();
                updateUI(doc.data());
            }
        }

        // Timed Checks
        function setupTimedChecks() {
            // Check at midnight
            const now = new Date();
            const midnight = new Date(
                now.getFullYear(),
                now.getMonth(),
                now.getDate() + 1,
                0, 0, 0
            );
            const msUntilMidnight = midnight - now;
            
            setTimeout(async function midnightCheck() {
                await updateStreak();
                setTimeout(midnightCheck, 24 * 60 * 60 * 1000);
            }, msUntilMidnight);
            
            // Hourly fallback check
            setInterval(async () => {
                const now = new Date();
                if (now.getHours() === 0 && now.getMinutes() === 0) {
                    await updateStreak();
                }
            }, 60 * 60 * 1000);
        }

        function generateStars() {
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('span');
                star.style.left = `${Math.random() * 100}%`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.width = `${Math.random() * 3}px`;
                star.style.height = star.style.width;
                star.style.animationDuration = `${Math.random() * 3 + 2}s`;
                star.style.animationDelay = `${Math.random() * 2}s`;
                starsContainer.appendChild(star);
            }
        }

        // Initialization
        async function initializeApp() {
            try {
                generateStars();
                levelUpBtn.addEventListener('click', handleLevelUp);
                
                await initializeUserData();
                const docRef = db.collection("atharvGrowth").doc("atharvData");
                const doc = await docRef.get();
                updateUI(doc.data());
                
                setupTimedChecks();
            } catch (error) {
                console.error("Initialization error:", error);
                showToast("Failed to initialize. Please refresh.", true);
            }
        }

        window.onload = initializeApp;
    </script>
</body>
</html>
